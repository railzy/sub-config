mixed-port: 7890
allow-lan: false
log-level: info
mode: Rule
# external-controller: '127.0.0.1:9090'
ipv6: true

#ã€Metaä¸“å±ã€‘ä½¿ç”¨geoip.datæ•°æ®åº“(é»˜è®¤ï¼šfalseä½¿ç”¨mmdbæ•°æ®åº“)
geodata-mode: true         

# å®éªŒæ€§åŠŸèƒ½
# experimental:
#   ignore-resolve-fail: true # å¿½ç•¥ DNS è§£æå¤±è´¥ï¼Œé»˜è®¤å€¼ä¸º true
  # interface-name: en0 # outbound interface name

#ã€Metaä¸“å±ã€‘snifferåŸŸåå—…æ¢å™¨
sniffer:
  enable: false
  ## å¯¹ redir-host ç±»å‹è¯†åˆ«çš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  ## å¦‚ï¼šTunã€Redir å’Œ TProxy å¹¶ DNS ä¸º redir-host çš†å±äº
  # force-dns-mapping: false
  ## å¯¹æ‰€æœ‰æœªè·å–åˆ°åŸŸåçš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  # parse-pure-ip: false
  # æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ true
  # å…¨å±€é…ç½®ï¼Œä¼˜å…ˆçº§ä½äº sniffer.sniff å®é™…é…ç½®
  override-destination: false
  sniff: # TLS é»˜è®¤å¦‚æœä¸é…ç½® ports é»˜è®¤å—…æ¢ 443
    TLS:
    #  ports: [443, 8443]
    
    # é»˜è®¤å—…æ¢ 80
    HTTP: # éœ€è¦å—…æ¢çš„ç«¯å£
      
      ports: [80, 8080-8880]
      # å¯è¦†ç›– sniffer.override-destination
      override-destination: true
  skip-domain:                   #åˆ—è¡¨ä¸­çš„sniå­—æ®µï¼Œä¿ç•™mappingç»“æœï¼Œä¸é€šè¿‡å—…æ¢è¿˜åŸåŸŸå
                                 #ä¼˜å…ˆçº§æ¯”force-domainé«˜
    - 'Mijia Cloud'              #ç±³å®¶è®¾å¤‡ï¼Œå»ºè®®åŠ 
    - 'dlg.io.mi.com'
    - '+.apple.com'              #è‹¹æœåŸŸåï¼Œå»ºè®®åŠ 
  # - '*.baidu.com'              #æ”¯æŒé€šé…ç¬¦
    
  force-domain:                  #éœ€è¦å¼ºåˆ¶å—…æ¢çš„åŸŸåï¼Œé»˜è®¤åªå¯¹IPå—…æ¢
  # - '+'                        #å»æ‰æ³¨é‡Šåç­‰äºå…¨å±€å—…æ¢
    - '+.google.com'
    - +.v2ex.com

dns:
  enable: true
  listen: ':5353'
  prefer-h3: true # å¼€å¯ DoH æ”¯æŒ HTTP/3ï¼Œå°†å¹¶å‘å°è¯•
  ipv6: true # when the false, response to AAAA questions will be empty

  # These nameservers are used to resolve the DNS nameserver hostnames below.
  # Specify IP addresses only
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 1.0.0.1
  #   - 8.8.4.4

  # æŸ¥è¯¢ hosts
  use-hosts: true 

  #æŒ‡å®šåŸŸåä½¿ç”¨è‡ªå®šä¹‰DNSè§£æ
  nameserver-policy:    
    'blhxstatic.yo-star.com':   'https://dns.alidns.com/dns-query'
    '+.dogfight360.com': 'https://dns.alidns.com/dns-query'
    # '+.cn': 'https://dns.alidns.com/dns-query'
    # steam æ£€æµ‹åœ°åŒº
    '+.cm.steampowered.com': 'https://dns.alidns.com/dns-query'
    '+.steamserver.net': 'https://dns.alidns.com/dns-query'
    '+.xboxlive.cn': 'https://dns.alidns.com/dns-query'
    'fe3cr.delivery.mp.microsoft.com': 'https://dns.alidns.com/dns-query'
    'packagespc.xboxlive.com': 'https://dns.alidns.com/dns-query'
  # 'www.baidu.com': 'https://223.5.5.5/dns-query'
  # '+.internal.crop.com': '114.114.114.114'
  enhanced-mode: redir-host # redir-host (will be deprecated) or fake-ip 
  fake-ip-range: 198.18.0.1/16 # Fake IP addresses pool CIDR
  # use-hosts: true # lookup hosts and return IP record
  
  # Hostnames in this list will not be resolved with fake IPs
  # i.e. questions to these domain names will always be answered with their
  # real IP addresses
  fake-ip-filter:
    - '*.lan'
    # QQ
    - +.qq.com
    - localhost.ptlogin2.qq.com
    # === Music Service ===
    ## NetEase
    - '+.music.163.com'
    - '*.126.net'
    # Google
    - '+.googleapis.com'
    - '+.googleapis.cn'
    - '+.googletraveladservices.com'
    - '+.google.com'
    - '+.googleusercontent.com'
    # mine
    - '+.ray404.dynv6.net'
    - '+.172333.xyz'

  # Supports UDP, TCP, DoT, DoH. You can specify the port to connect to.
  # All DNS questions are sent directly to the nameserver, without proxies
  # involved. Clash answers the DNS question with the first result gathered.
  nameserver:
    # - tls://dns.rubyfish.cn:853 # DNS over TLS
    - https://dns.alidns.com/dns-query # DNS over HTTPS
    # - "[2400:3200::1]:53"
    - https://doh.pub/dns-query
    # - https://223.5.5.5/dns-query
    # - dhcp://system # æ·»åŠ ç³»ç»Ÿ DNSï¼Œè¿™ç§å†™æ³•åªåœ¨å®‰å“æœ‰æ•ˆ
    # - 114.114.114.114 # default value
    # - https://dns.google/dns-query
    # - https://doh.pub/dns-query
    # - https://1.1.1.1/dns-query # DNS over HTTPS
    # - https://rubyfish.cn/dns-query
    # - https://i.233py.com/dns-query


  # When `fallback` is present, the DNS server will send concurrent requests
  # to the servers in this section along with servers in `nameservers`.
  # The answers from fallback servers are used when the GEOIP country
  # is not `CN`.
  fallback:
    # ã€Metaä¸“å±ã€‘
    # æŒ‡å®š DNS è¿‡ä»£ç†æŸ¥è¯¢ï¼ŒProxyGroupName ä¸ºç­–ç•¥ç»„åæˆ–èŠ‚ç‚¹åï¼Œè¿‡ä»£ç†é…ç½®ä¼˜å…ˆäºé…ç½®å‡ºå£ç½‘å¡ï¼Œå½“æ‰¾ä¸åˆ°ç­–ç•¥ç»„æˆ–èŠ‚ç‚¹ååˆ™è®¾ç½®ä¸ºå‡ºå£ç½‘å¡
    - 'https://dns.google/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'
    - 'https://cloudflare-dns.com/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'

    # - "[2001:4860:4860::8888]:53" # Google ipv6 dns
    # - tls://1.0.0.1
    # - 1.0.0.1
    # - https://1.0.0.1/dns-query # DNS over HTTPS
    # - https://8.8.4.4/dns-query
    # - tls://8.8.4.4
    # - tls://dns.google
    # - tls://8.8.8.8
    # - 1.1.1.1
    # - https://dns.rubyfish.cn/dns-query
    # - 8.8.4.4
    # - tls://dns.rubyfish.cn:853 # DNS over TLS
  # DoH and DoT fallback server not work in scut. Don't use.


  # If IP addresses resolved with servers in `nameservers` are in the specified
  # subnets below, they are considered invalid and results from `fallback`
  # servers are used instead.
  #
  # IP address resolved with servers in `nameserver` is used when
  # `fallback-filter.geoip` is true and when GEOIP of the IP address is `CN`.
  #
  # If `fallback-filter.geoip` is false, results from `nameserver` nameservers
  # are always used if not match `fallback-filter.ipcidr`.
  #
  # This is a countermeasure against DNS pollution attacks.
  fallback-filter:
    geoip: true
    geoip-code: CN                   #geoipåŒ¹é…åŒºåŸŸè®¾å®š
    #ã€Metaä¸“å±ã€‘è®¾å®šgeositeæŸåˆ†ç±»ä½¿ç”¨fallbackè¿”å›ç»“æœ
    # ä¼šè¯¯ä¼¤éƒ¨åˆ†ç›´è¿ç½‘ç«™
    # ä¾‹ï¼šä½¿ç”¨ https://www.gstatic.com/generate_204 æµ‹ DIRECT ä¼š timeout
    # geosite:                         
    #   - gfw
    ipcidr:
      # - 0.0.0.0/8
      # - ::/128
      - 240.0.0.0/4
    domain:
       - '+.google.com'
       - '+.youtube.com'
       - '+.githubusercontent.com'
       - '+.exhentai.org'
       - '+.e-hentai.org'
       - '+.v2ex.com'
       # Google
       - '+.googleapis.com'
       - '+.googleapis.cn'
       - '+.googletraveladservices.com'
       - '+.google.com'
       - '+.googleusercontent.com'
       # mine
       - '+.ray404.dynv6.net'
       - '+.172333.xyz'
